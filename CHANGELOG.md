大量重构，添加fabric支持，功能基本不变
修复一个造成崩溃的问题（简单用try-catch包扎了一下）